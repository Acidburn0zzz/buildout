[buildout]
extends = versions.cfg
unzip = true
parts =
    zodbtools
    instance
    cache
    upload
    wsgi
    deploy.ini
    debug.ini

[mod_wsgi_app]
recipe = collective.recipe.modwsgi
eggs = ${wsgi:eggs}
config-file = ${deploy.ini:output}

[wsgi]
recipe = zc.recipe.egg
eggs =
   ${instance:eggs}
   infrae.wsgi
   Paste
   PasteScript
   PasteDeploy
   z3c.evalexception
   silva.core.upgrade

# We mentioned silva.core.upgrade above to install silvaupdate

[deploy.ini]
recipe = collective.recipe.template
input = ${buildout:directory}/templates/deploy.ini
output = ${buildout:directory}/deploy.ini

[debug.ini]
recipe = collective.recipe.template
input = ${buildout:directory}/templates/debug.ini
output = ${buildout:directory}/debug.ini

[instance]
recipe = plone.recipe.zope2instance
blob-storage = ${buildout:directory}/var/filestorage/blobs
user = admin:admin
debug-mode = off
http-address = 8080
eggs =
  Zope2
  Products.Silva
  Products.SilvaFind
  Products.SilvaForum
  Products.SilvaDocument
  Products.SilvaNews
  silva.pas.base
  silva.app.document
  silva.app.news
  silva.app.redirectlink
  silva.security.addables
  silva.security.overview
  silva.security.logging
  silva.security.renameusers
  silvatheme.multiflex
  infrae.wsgi
zcml =
  Products.Silva
  Products.SilvaFind
  Products.SilvaForum
  Products.SilvaDocument
  Products.SilvaNews
  silva.pas.base
  silva.app.document
  silva.app.news
  silva.app.redirectlink
  silva.security.addables
  silva.security.overview
  silva.security.logging
  silva.security.renameusers
  silvatheme.multiflex
  infrae.wsgi
zope-conf-additional =
  <product-config silva.core.cache>
    memcache memory

    default.type memorylru
    default.lock_dir ${buildout:directory}/var/cache/lock/default
    auth.type file
    auth.lock_dir ${buildout:directory}/var/cache/lock/auth
    auth.data_dir ${buildout:directory}/var/cache/data/auth
  </product-config>
  <product-config zeam.form.silva>
    upload-directory ${buildout:directory}/var/uploads/storage
  </product-config>

# Those package doesn't include properly their dependencies in ZCML
# and breaks everything
# silva.app.oaiprovider

[upload]
recipe = z3c.recipe.mkdir
paths =
   var/uploads/storage
   var/uploads/tmp
remove-on-update = yes

[cache]
recipe = z3c.recipe.mkdir
paths =
   var/cache/lock/default
   var/cache/lock/auth
   var/cache/data/auth
remove-on-update = yes

[zodbtools]
recipe = zc.recipe.egg
eggs =
    zodbupdate
    ${instance:eggs}
