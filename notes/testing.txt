================
Silva 3.0 issues
================

++ Items with a double plus need to be fixed to get infrae.com running in 3.0.


General comments
----------------

- When in a tab and you want to reload it (just to be sure it's up to
  date) you go to the selected tab, hover, your cursor turns to a
  pointer so it's obviously a link, you click, and nothing
  happens. However sometimes, when in a subscreen like "View previous
  version", the link does work and it's the only way to get back to
  the main screen. Best would be if the link always worked. Second
  best is that the tab ceases to be a link when selected, but then you
  have to go to another tab and back to get a reload.

- Changing languages does not change the UI. The user must reload. Can
  we do that for the user?

Login
=====

- Logout and in: after clicking the logout button the browser goes to:
  http://next30.infrae.com/service_members/logout or
  http://preprod30.infrae.com/service_members/logout
  If I want to login again immediately it's not possible to login and you can
  try as many times as you like. Is this a non-wsgi occurance? It was really
  confusing and needs to change.

Contents screen
---------------

- When a document is published, the "Go to" button has Preview. as the first
  option. It should have View too. Save a click.
  We're going to make that menu optional, right?

+ When a document doesn't have a tile, it's id gets displayed instead. Thus one
  thinks the doc does have a title (albeit a lousy one). We need to display the
  string "no title" instead.

-----> This was the same behavior in the old Silva.
-----+ Well, in the Contents screen the old Silva displayed "no title".

- The 'collapser' reads "Structural content(s)", "Structural content" is enough.
  The others, Asset(s) and Page Model(s) can dispense with the parentheses and
  just read Assets and Page Models.

Export xcreen
-------------
+ Error page:
  "You tried to export the content [Chief Editor] which contains the content
  [Roles and permissions] who have a reference to the content [Author – basic]
  which is not itself contained in the exported content. ."
  to:
  "Sorry, you tried to export the content [Chief Editor]. This contains the content
  [Roles and permissions] which has a reference to the content [Author – basic]
  which is not itself contained in the exported content.
  Please go back using your browser's back button"

Edit screen of docs
-------------------
+ When I make multiple edits of a document, and then publish, it seems I get a
  jGrowl notification for each of the preceding saves. Sometimes twenty, and
  then the feedback falls off the screen. Can we consolidate this to one?

Publish screen of docs, logged in as ChiefEditor
------------------------------------------------

= Compare is really cool! Looks and works great!

To test: Is the publishing workflow email working?

Functional fixes
~~~~~~~~~~~~~~~~

Datetime fields

Publication time

- Manually filling in 28-8-11 causes an error (on the 11). The server
  should interpret the 11 as 2011. Only happens for Editors, for
  Authors the year is correctly interpreted. Should be easy to
  fix. Then we can probably ignore the following:

- Wrong feedback after internal system error. To reproduce, go to a
  document and fill in a year of '11'. Click "Publish now". You'll
  get the "An internal error happened" alert. Click "Continue". Then
  click a folder in the sidebar. Feedback appears, saying "Version
  published".

Notes since changing the fields

- If I remove the year completely, the whole row goes pink and I get
  validation feedback "Missing year value.". However if I fill in
  '11', the only feedback is the pink glowing border, and I can still
  submit and get the error described above.

- Why can Authors successfully submit a year of '11' but not Editors?
  The '11' gets correctly interpreted in the Author's submit, but Editors
  get a system error. Can you make it interpret correctly for Editors
  too? Saves 2 chars.

Manage versions

- View: when viewing an old version the "Publish now" button in the
  header should not appear, as you're not publishing the version
  you're viewing. Change it to a "Return" button?


Autotoc
=======

- When previewing an Autotoc, content in draft mode doesn't appear.


UI/usability fixes
~~~~~~~~~~~~~~~~~~

Submit buttons and reporting

+ When a doc is approved for the future, you can't see that it is
  approved for the future. The only indication is the "Publish Now"
  button changes to "Revoke Approval". No information about the future
  date of publication is visible. You only see "Manage versions". It's
  especially confusing if a doc is already published, then you see
  "Manaal close" and a "x Close published version" button, but nothing
  about the approval:
  (http://next30.infrae.com/edit#publish!products/lxml). We can
  display the future approval date in the "Information", but I'd
  rather see it in the form body itself because that's where users
  will be looking, and they can change it if needed.

Manage versions

- View: when viewing an old version there's no obvious way to get back
  the publish screen. We can let people learn to click on the already
  selected tab, but that's not obvious. Let's replace the workflow-action
  button (which appears under the item icon/title) with a "Back" button.
  We need to get rid of the "New version"/"Revoke..."/"Publish" action
  button when viewing an old version anyway.
  [However this is not optimal because we're mixing actions with navigation.
  Any better ideas? Deselect the Publish tab and select the Preview button?]

(BROWSER->DUTCH) Date rendering and interpretation

Logged in as Author
===================

Publish screen of docs
----------------------

Publication time

- Strangely, if I enter '11' into the year field as an Author, the
  value is accepted and becomes 2011. This fails when an Editor
  publishes.

Message

- The text area (this and all the others) has a fixed width and is
  often too long. Granted, in Safari and recent FF you can scale it
  yourself. A max-width that is 20px less than its parent should work.
  THEY DIDN'T HAVE IN THE OLD ONE EITHER. PLEASE PROPOSE TITLES - The
  "Request appoval", "Withdraw approval request", "Reject approval
  request", and probably more button/links don't have a title
  attribute:
"Request approval": Submit this content to be published.
"Withdraw approval request": Re-edit this content.
"Reject approval request": Put this content back in draft mode.



Logged in as ChiefEditor
========================

Publish screen of docs
----------------------

- When an Editor goes to the Publish screen of a doc that's been
  submitted for approval, it's not really obvious that the doc is
  waiting for approval. The only indication is there's both a "Publish
  Now" and "Reject Request" button (looking good together). Not sure
  if we should do something more.

Silva News Network
==================

- The month field lets me fill in '19'. Can the inline validation do a
  range check like it does in publish?

- After submitting the above entry, the entire multi-field goes pink,
  and I have no idea which of the seven subfields contains the error. We
  need to figure out something here. Don't we know what the invalid
  entry is?

Addables
--------

+ In the WU wwwtest site the Addables are not set correctly:
  1. In the root Silva News Page, Agenda Page, News Item, and Agenda Item
     were available.
  2. In the "News WU" News Pub none of the article types were available.
  3. In the root, Silva Forum Topic and Forum Comment were available. These
     should only appear inside Silva Forums. Haven't checked those....
  Both of these were manually fixed (had to turn off Acquire, also in the root),
  and they are many more News Pubs scattered around the site.

Metadata system
---------------

Still 404s:
http://next30.infrae.com/service_metadata/collection/augmentation/manage_settings
+ It's not possible to make a metadata set editable. It 404s.
  This seems to be an Apache-related problem. Actually, the action succeeded,
  it's the subsequent redirect that failed.

XXX Still 404s:
http://next30.infrae.com/service_metadata/collection/augmentation/?%3Amethod=addElementForm&submit=+Add+Metadata+Element
+ It's not possible to add a field to a metadata set. It 404s.

Silva News Filter
-----------------

- Title field(s) are too short. Make them size="40".

- The "montrer les éléments d'agenda" checkbox with no label looks
  lost. Can we always put a 'Yes" label next to these?

Silva Find
==========

+ The Zope level icons are being used in the search results. We should make the
  Zope icons match. This is something Wim or I can do if you explain it.

+ How do we call a stylesheet for a specific metatype now? I used to include it
  in the head inject but I think there's a cleaner way, e.g. I see calendar.css
  in SNN. We need one for Find objects.

Silva Indexer
=============

+ The Indexer is indexing all anchors, not just those that have a title. This
  needs to be fixed. See infrae.com, where the first items have no term but are
  still listed:
    http://infrae.com/edit#preview!../indexer
  From  the docs:
  "The difference is an index item has both a name and a title. The Indexer only
  presents anchor/index items that have a title."


External Sources
================

- When editing an External Source in the editor, the source edit form doesn't
  display the title of the source, so you have no idea which Code/SQP/CSV
  source you're editing. Please make the title display at the top of the form.

+ It's not possible to tab between fields in the External Source Settings form.
  Somehow we have to fix this usability problem.

+ Bug: in Silva 3.0 existing Code Sources lose all their values if a parameter
  is deleted. This happens on save when the Code Source itself wasn't edited:
  http://preprod30.infrae.com/++preview++/about
  If you scroll down, next to the "Open Source Experience" heading there's an
  empty Code Source, which used to contain values as like here:
  http://infrae.com/about
  I deleted the alignment parameter, since it's now built-in, and when I tested
  I noticed that it lost all parameter values. Can this be fixed so existing
  values are preserved?

- Typo in the error message:
  "External Source unknow is not available."
  "External Source unknown is not available."

+ It is not possible to add a csv source anymore, although content with
  one embedded still
  works. http://preprod30.infrae.com/edit#content!lobby/testors/tabbed
  and http://preprod30.infrae.com/edit#content!lobby/testors/tablular

CS Silva Portlet
----------------
+ New detail: the source only errors in preview. In the public view it renders
  fine, regardless of where the embedded doc is. Still needs to be fixed, but
  this makes it less urgent.
  If the document you're embedding is in the root, the souce throws an error.
  Example doc: http://preprod30.infrae.com/edit#content!lobby/testors/portleteur
  Embedded doc: http://preprod30.infrae.com/edit#content!lobby/locateabove
  Code Source: http://preprod30.infrae.com/cs_portlet_element/editCodeSource

CKEditor
========

- Anchors don't work in Preview mode. If you click on an anchor you don't go
  to the anchor target.

- You can't remove anchors, not with the remove link, and not with
  backspace are del key.

- Updating an existing anchor names fails. After saving it gets
  replaced with the old anchor name.

- Adding a link to an image fails. It just doesn't stick.

  Now I've finally figured out that you can't add a link to an image. You can
  only add a link to text. But if you edit the image, then when you're editing
  it, you can add a link. Is this CKEditor behavior? Because I fear our users
  will never unlearn this process. Or is it a bug?

  Can we code it so that if a user selects an image and then clicks the link
  icon, they're brought to the image edit dialog with the link tab forward?

+ When you add an image in CKEditor, you usually add the image on an empty
  line. When done adding, it looks fine. After saving, the editor inserts an
  extra p with a nbsp above the image. You always have to remove this p after
  saving. Annoying. Same goes for Code Sources.

+ Typo: when saving in CKEditor and it fails the error message states:
  "Error on the server while saving document, Please consult log server for
   detail"
  "An error occurred while saving this document, Please consult the server log
   for details."
  However, we should not show this text to Authors, so fallback to:
  "Sorry, an error occurred while saving this document, We won't tell anybody
   you did it."

+ It's not possible to edit an Anchor. I tried to change this anchor into
  'Forest_Paths'. It doesn't stick after saving. See:
  infrae.com/products/silva/developer/blueprints/shorturls#Marketing_Links

Reference dialog
================

- The reference dialog has a difficult user interface if there are more
  than a few items in the listing. The selection(s) show up at the bottom
  of the listing, often out of sight for the user. Can we put the selected
  list on top?
  Wim: Which reference dialog is this? The ones I use only use one reference
  selection, which is never displayed.
  Kit: Try the TOC CS, in which you can add multiple containers.

- In the reference dialog clicking the icon of a non-container doesn't do
  anything. Make it trigger the same action as the 'plus' icon on the right.
  This obviates the need to move the mouse across the screen, which new
  users find confusing because the selection checkbox used to be on the left.
  """WB: Non of the icons reference the add action, only the '+' icon adds a
  reference."""

SMI Sidebar
===========
+ The sidebar navigation should use short titles. So instead of "The Silva
  Content Management System" it should just read "Silva".

Bugs
====

+ When asking for approval as an author a document with an expiration
  date, there is no screen where any role can verify the set expiration
  date. You can only see the expiration date if you make a new version
  of it and then you can see it in the date time field next to the
  date/time picker. It does not get listed in the 'Manage versions'
  overview, nor in any screen for the editor.

+ It looks like the messaging service is not working. I added a
  mailhost, configured the service, add emails for the users, but I
  don't receive messages nor get a PDB when sending a request for approval.

+ After uploading a new image to replace a different one, you see the
  scaled old image to the dimensions of the new image.

+ Preview of an image doesn't go away. In some cases the small preview
  of an image doesn't go away.

+ Empty crop coordinates can't be saved, so you need to crop every
  image for a change in image format or other change.

+ View unscaled image doesn't work.
  http://infrae.com/st/edit#content!silva_docs_trunk/getting_started/accessedit.png

+ Pop-ups like the Image properties one can't be resized anymore.

- If you fill in a publication date as an author and request approval,
  the editor will only see the current date filled in as publication
  date, and not the one set by the author. He therefore will always
  approve and publish immediately.

- How can a user export one document? We only have an export screen in
  containers now. Can we add an Export option to the "Edit" tab, like the
  Details option in news items?

----> How did you do this in the past ?

----+ In the Status screen, click the Export button, e.g.:
      http://infrae.com/lobby/testors/imagealigns/edit/tab_status
      But there's some hack that somehow brings you up into the folder with an
      argument to export only that particular document. This is an extremely
      handy feature.

To Test
-------
- CSV upload has problems.
  Invalid CSV file: new-line character seen in unquoted field - do you need to
  open the file in universal-newline mode?

Silva News
----------

Tested:
- Inside new News Pubs the addables are not set correctly.
  After a fresh upgrade the News Item is not selected in Addables (but
  strangely enough Agenda Item is).

Error log
=========

Settings button errors
----------------------

Error at http://infrae.com/st/silva_docs_trunk/++rest++silva.ui/settings/GET on 2012-09-27 16:13:10.075214:

Object class: __builtin__.instancemethod
Object path: n/a
Request URL: http://infrae.com/st/silva_docs_trunk/++rest++silva.ui/settings/GET
Request method: GET
Query string: _=1348755190556
User: wim
User-agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.7; rv:15.0) Gecko/20100101 Firefox/15.0.1
Refer: http://infrae.com/st/edit
Traceback (innermost last):
  Module infrae.wsgi.publisher, line 350, in publish_and_manage_errors
  Module infrae.wsgi.publisher, line 329, in publish
   - Published class: __builtin__.instancemethod
   - Object path: n/a
   - Object type: n/a
  Module ZPublisher.mapply, line 77, in mapply
  Module infrae.wsgi.publisher, line 40, in call_object
  Module silva.ui.rest.base, line 89, in GET
  Module silva.ui.rest.base, line 135, in get_payload
  Module zeam.form.silva.form.smi, line 157, in payload
  Module zeam.form.base.form, line 114, in render
  Module megrok.pagetemplate.components, line 16, in __call__
  Module grokcore.chameleon.components, line 98, in render
  Module chameleon.template, line 125, in __call__
  Module chameleon.zpt.template, line 259, in render
  Module chameleon.template, line 172, in render
  Module smicomposedformtemplate_fca77c6e43af3c957e4419a005da6a9994e99afa, line 275, in render
  Module zeam.form.base.form, line 114, in render
  Module megrok.pagetemplate.components, line 16, in __call__
  Module grokcore.chameleon.components, line 98, in render
  Module chameleon.template, line 125, in __call__
  Module chameleon.zpt.template, line 259, in render
  Module chameleon.template, line 172, in render
  Module smisubformgrouptemplate_07c4c2dcc6bbd88378c39c5ed32abb46f93af1a2, line 272, in render
  Module zeam.form.base.form, line 110, in render
  Module grokcore.chameleon.components, line 98, in render
  Module chameleon.template, line 125, in __call__
  Module chameleon.zpt.template, line 259, in render
  Module chameleon.template, line 190, in render
  Module chameleon.template, line 172, in render
  Module metadataform_92381f19bd56de402bd68d176c80f51f9477d4f2, line 397, in render
  Module silva.core.smi.content.metadata, line 127, in is_element_editable
  Module Products.Silva.Security.management, line 41, in is_role_greater_or_equal
ValueError: tuple.index(x): x not in tuple

 - Expression: "form.render()"
 - Filename:   ... orm/silva/form/smi_templates/smicomposedformtemplate.cpt
 - Location:   (14:35)
 - Expression: "view.is_element_editable(*identifier)"
 - Filename:   ... lva/core/smi/content/metadata_templates/metadataform.cpt
 - Location:   (22:33)
 - Arguments:  repeat: {...} (0)
               static: <ZopeFanstaticResource - at 0x367ff0d0>
               escape: False
               is_hidden: False
               is_acquired: False
               element_name: skin
               target_language: en
               set_name: silva-layout
               request: <instance - at 0x182c5320>
               context: <ImplicitAcquisitionWrapper silva_docs_trunk at 0x2fb52960>
               error: <NoneType - at 0x68ac90>
               identifier: <tuple - at 0x180755f0>
               view: <NonVersionedContentMetadataForm - at 0x367ffc50>

Export (export of imported content)
-----------------------------------

Error at http://infrae.com/st/silva_docs_trunk/++rest++silva.ui/content/export/GET on 2012-09-27 16:11:49.038653:

Object class: __builtin__.instancemethod
Object path: n/a
Request URL: http://infrae.com/st/silva_docs_trunk/++rest++silva.ui/content/export/GET
Request method: GET
Query string: form.field.export_format=zip&form.field.html_skin=silva.export.html.interfaces.IDefaultHTMLExportSkin&form.field.export_newest_version_only=True&form.action.export=%0A++%0A++Export%0A
User: wim
User-agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.7; rv:15.0) Gecko/20100101 Firefox/15.0.1
Refer: http://infrae.com/st/edit
Traceback (innermost last):
  Module infrae.wsgi.publisher, line 350, in publish_and_manage_errors
  Module infrae.wsgi.publisher, line 329, in publish
   - Published class: __builtin__.instancemethod
   - Object path: n/a
   - Object type: n/a
  Module ZPublisher.mapply, line 77, in mapply
  Module infrae.wsgi.publisher, line 40, in call_object
  Module silva.ui.rest.base, line 89, in GET
  Module silva.ui.rest.base, line 135, in get_payload
  Module zeam.form.silva.form.smi, line 98, in payload
  Module zeam.form.base.form, line 301, in updateActions
  Module zeam.form.base.actions, line 60, in process
  Module silva.core.smi.content.xml.export, line 70, in __call__
  Module Products.Silva.adapters.zipfileexport, line 60, in export
  Module Products.Silva.silvaxml.xmlexport, line 547, in exportToString
  Module sprout.saxext.xmlexport, line 125, in exportToString
  Module sprout.saxext.xmlexport, line 114, in exportToFile
  Module sprout.saxext.xmlexport, line 102, in exportToSax
  Module Products.Silva.silvaxml.xmlexport, line 425, in sax
  Module sprout.saxext.xmlexport, line 270, in subsax
  Module Products.Silva.silvaxml.xmlexport, line 232, in sax
  Module Products.Silva.silvaxml.xmlexport, line 195, in contents
  Module sprout.saxext.xmlexport, line 270, in subsax
  Module silva.app.document.silvaxml.xmlexport, line 24, in sax
  Module Products.Silva.silvaxml.xmlexport, line 175, in versions
  Module sprout.saxext.xmlexport, line 270, in subsax
  Module silva.app.document.silvaxml.xmlexport, line 37, in sax
  Module silva.core.editor.transform.silvaxml.xmlexport, line 111, in sax
  Module silva.core.editor.transform.base, line 68, in __call__
  Module Products.SilvaExternalSources.silvaxml.xmlexport, line 80, in __call__
  Module zeam.form.silva.xml, line 35, in __call__
  Module zeam.form.silva.xml, line 32, in serialize
  Module Products.Formulator.Validator, line 623, in serializeValue
TypeError: 'NoneType' object is not iterable

Google bot
----------

Error at https://m.m.m.m.*.infrae.com/infrae.com/infrae.com/products/kupu_editor/@@index.html on 2012-09-27 15:37:29.842874:

[How can this be reproduced?]

Error while rendering error message
Object class: Products.Silva.Ghost.Ghost
Object path: /infrae.com/products/kupu_editor
Request URL: https://m.m.m.m.*.infrae.com/infrae.com/infrae.com/products/kupu_editor/@@index.html
Request method: GET
Query string: n/a
User: Anonymous User
User-agent: Mozilla/5.0 (compatible; Googlebot/2.1; +http://www.google.com/bot.html)
Refer: n/a
Traceback (innermost last):
  Module infrae.wsgi.publisher, line 228, in error
  Module grokcore.layout.components, line 88, in __call__
  Module grokcore.layout.components, line 68, in __call__
  Module silva.core.layout.porto.porto, line 57, in update
  Module silva.core.layout.porto.porto, line 36, in update
  Module Products.Silva.SilvaObject, line 80, in get_title_or_id
  Module Products.Silva.VersionedContent.content, line 64, in get_title
  Module Products.Silva.Ghost, line 93, in get_title
  Module Products.Silva.Ghost, line 147, in get_haunted
  Module silva.core.references.service, line 77, in get_reference
  Module silva.core.references.reference, line 33, in get_content_id
  Module five.intid.intid, line 36, in register
  Module zope.component.hookable, line 33, in __call__
  Module zope.component.hooks, line 104, in adapter_hook
  Module five.intid.keyreference, line 55, in __init__
NotYet: <GhostVersion at 1>

