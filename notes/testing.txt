================
Silva 3.0 issues
================

++ Items with a double plus need to be fixed to get infrae.com running in 3.0.


General comments
----------------

- When in a tab and you want to reload it (just to be sure it's up to
  date) you go to the selected tab, hover, your cursor turns to a
  pointer so it's obviously a link, you click, and nothing
  happens. However sometimes, when in a subscreen like "View previous
  version", the link does work and it's the only way to get back to
  the main screen. Best would be if the link always worked. Second
  best is that the tab ceases to be a link when selected, but then you
  have to go to another tab and back to get a reload.

- Changing languages does not change the UI. The user must reload. Can
  we do that for the user?


Login
=====

- Logout and in: after clicking the logout button the browser goes to:
  http://next30.infrae.com/service_members/logout If I want to login
  immediately (noticed a typo or as another user) it's not possible to
  login and you can try as many times as you like. This was really
  confusing and needs to change.

Contents screen
---------------

+ When a document is closed it's not possible to publish it. You must create
  a new version, and then publish it. Can we help the user and provide a
  shortcut so closed content can be published in one shot? We're adding clicks
  here.

- When a document is published, the "Go to" button has Preview. as the first
  option. It should have View too. Save a click.

+ When a document doesn't have a tile, it's id gets displayed instead. Thus one
  thinks the doc does have a title (albeit a lousy one). We need to display the
  string "no title" instead.

-----> This was the same behavior in the old Silva.


Publish screen of docs, logged in as ChiefEditor
------------------------------------------------

To test: Is the publishing workflow email working?

Functional fixes
~~~~~~~~~~~~~~~~

Datetime fields

Publication time

- Manually filling in 28-8-11 causes an error (on the 11). The server
  should interpret the 11 as 2011. Only happens for Editors, for
  Authors the year is correctly interpreted. Should be easy to
  fix. Then we can probably ignore the following:

- Wrong feedback after internal system error. To reproduce, go to a
  document and fill in a year of '11'. Click "Publish now". You'll
  get the "An internal error happened" alert. Click "Continue". Then
  click a folder in the sidebar. Feedback appears, saying "Version
  published".

Notes since changing the fields

- If I remove the year completely, the whole row goes pink and I get
  validation feedback "Missing year value.". However if I fill in
  '11', the only feedback is the pink glowing border, and I can still
  submit and get the error described above.

- Why can Authors successfully submit a year of '11' but not Editors?
  The '11' gets correctly interpreted in the Author's submit, but Editors
  get a system error. Can you make it interpret correctly for Editors
  too? Saves 2 chars.

Manage versions

- Please make the version status text a link to view it. Now we're
  adding a click, by making users first select a checkbox, then click
  "View". If you want to keep it black we'll style the link that way.

- Delete: When selecting items for deletion, the form remains sticky
  with selections after deletion, e.g. if you delete versions 2 and 3,
  the form comes back with items 0 and 1 selected.

- Delete: We don't ask, "Are you sure?" on the delete action. Should we?

- View: when viewing an old version the "Publish now" button in the
  header should not appear, as you're not publishing the version
  you're viewing. Change it to a "Return" button?

Image
=====

- Something's broken, When clicking the "Upload" button (in FF) nothing happens.
Actually, the upload dialog appears, but behind the "Lookup a content" dialog.
But now I can't reproduce this....

Image rendering
---------------
++ See fix below....
  There's a change in the image rendering which is not compatible with existing
  stylesheets. Here's a 2.3 image:

  <a href="tel:+31102437051" title="" target="_self"><img src="http://infrae.com/contact/infrae_qr_tel.png" alt="Infrae telephone QR code" class="default"></a>

  Here's a converted 3.0 image:

  <div class="image default">
	  <a class="image-link" target="_self" title="Call Infrae HQ" href="tel:+31102437051"><img alt="Infrae telephone QR code" src="http://preprod30.infrae.com/++preview++/contact/infrae_qr_tel.png"></a></div>

  The 3.0 image is wrapped in a div with a class, but the css class needs to be
  put on the image itself. But of course it's not that simple. There are six
  possible alignments:
.default
.image-left
.image-center
.image-right
.float-left
.float-right

  The default and float-* styles get applied to the image itself and it's not
  wrapped in a div. The three align-* styles need to be wrapped in a div (in
  order to apply text-align) and the class is applied to both the div and the
  image.

  Here's an example output of a doc I created in the Infrae site. We can use
  this doc to test the migration (html cleaned up). The test doc is at:
  http://infrae.com/lobby/testors/imagealigns/edit/tab_preview

<article class="col66 first">
<h2 class="heading">Image Alignments</h2>

<p class="p">default</p>
<img src="http://infrae.com/++preview++/infrae_logo106x52t.png" alt="Infrae logo" class="default">

<p class="p">align left</p>
<div class="image-left">
  <img src="http://infrae.com/++preview++/infrae_logo106x52t.png" alt="Infrae logo" class="image-left">
</div>

<p class="p">align center</p>
<div class="image-center">
  <img src="http://infrae.com/++preview++/infrae_logo106x52t.png" alt="Infrae logo" class="image-center">
</div>

<p class="p">align right</p>
<div class="image-right">
  <img src="http://infrae.com/++preview++/infrae_logo106x52t.png" alt="Infrae logo" class="image-right">
</div>

<p class="p">float left</p>
<img src="http://infrae.com/++preview++/infrae_logo106x52t.png" alt="Infrae logo" class="float-left">

<p class="p">float right</p>
<img src="http://infrae.com/++preview++/infrae_logo106x52t.png" alt="Infrae logo" class="float-right">

</article>

Link
====

target of relative link

- Change to "Click the Lookup button to select an item to refer to."
  (Writing "a content" is not good form, the word content is treated as
  a plural form. Not sure why....)

-----> 'content' is mentioned all the place. I guess all messages should be changed ?

Autotoc
=======

- When previewing an Autotoc, content in draft mode doesn't appear.

Add forms
=========

Ghost, Ghost Folder, Link

- Change "no reference selected" to "Click the Lookup button to select
  a reference. "


UI/usability fixes
~~~~~~~~~~~~~~~~~~

Submit buttons and reporting

- When a doc is approved for the future, you can't see that it is
  approved for the future. The only indication is the "Publish Now"
  button changes to "Revoke Approval". No information about the future
  date of publication is visible. You only see "Manage versions". It's
  especially confusing if a doc is already published, then you see
  "Manaal close" and a "x Close published version" button, but nothing
  about the approval:
  (http://next30.infrae.com/edit#publish!products/lxml). We can
  display the future approval date in the "Information", but I'd
  rather see it in the form body itself because that's where users
  will be looking.

Manual close

- Under "Manual close", the hint should have the same font-style as
  the field hints. The selector is '.form-head p'. Currently hints are
  in italic (which should change because it doesn't make sense, but
  let's first be consistent).

- Vertical space under "Manual close" between hint and button needs to
  collapse and match the spacing between hints and fields.

Manage versions

- Personally I miss the link colors for Unapproved, Published, and
  Last closed. They made it so clear and you could instantly see what
  was what. Now you have to read each one. We do have room to put
  colored balls next to the version number but they won't look good.

- View: when viewing an old version there's no obvious way to get back
  the publish screen. We can let people learn to click on the already
  selected tab, but that's not obvious.

(BROWSER->DUTCH) Date rendering and interpretation

Logged in as Author
===================

Publish screen of docs
----------------------

Publication time

- Strangely, if I enter '11' into the year field as an Author, the
  value is accepted and becomes 2011. This fails when an Editor
  publishes.

Message

- The text area (this and all the others) has a fixed width and is
  often too long. Granted, in Safari and recent FF you can scale it
  yourself. A max-width that is 20px less than its parent should work.
  THEY DIDN'T HAVE IN THE OLD ONE EITHER. PLEASE PROPOSE TITLES - The
  "Request appoval", "Withdraw approval request", "Reject approval
  request", and probably more button/links don't have a title
  attribute:
"Request approval": Submit this content to be published.
"Withdraw approval request": Re-edit this content.
"Reject approval request": Put this content back in draft mode.


Logged in as ChiefEditor
========================

Publish screen of docs
----------------------

- When an Editor goes to the Publish screen of a doc that's been
  submitted for approval, it's not really obvious that the doc is
  waiting for approval. The only indication is there's both a "Publish
  Now" and "Reject Request" button (looking good together). Not sure
  if we should do something more.

SNN
===

- The month field lets me fill in '19'. Can the inline validation do a
  range check like it does in publish?

- After submitting the above entry, the entire multi-field goes pink,
  and I have no idea which of the seven fields contains the error. We
  need to figure out something here. Don't we know what the invalid
  entry is?

Silva News Filter

- Title field(s) are too short. Make them size="40".

- The "montrer les éléments d'agenda" checkbox with no label looks
  lost. Can we always put a 'Yes" label next to these?

Silva Find
==========

++ The templates that include headings need to be adjusted (h1, etc.).
  subscriptions.html

+ The Zope level icons are being used in the search results. We should make the
  Zope icons match. This is something Wim or I can do if you explain it.

++ How do we call a stylesheet for a specific metatype now? I used to include it
  in the head inject but I think there's a cleaner way, e.g. I see calendar.css
  in SNN. We need one for Find objects.

External Sources
================

- When editing an External Source in the editor, the source edit form doesn't
  display the title of the source, so you have no idea which Code/SQP/CSV
  source you're editing. Please make the title display at the top of the form.

+ It's not possible to tab between fields in the External Source Settings form.
  Somehow we have to fix this usability problem.

++ See fix below....
  When adding a Code Source there is now a built-in "Source alignment" field
  which is nice. Saves adding it to every source. The rendering of the classes
  is problematic.
  For align-right it adds the class 'source-right'. For float right it adds
  "source-float-right". These must be the 'generic' selectors, as found in
  existing stylesheets, in order to be compatible with existing skins. These are
  the alignments in the CSS of various skins:
.default
.align-left
.align-right
.align-center
.float-left
.float-right

+ Bug: in Silva 3.0 existing Code Sources lose all their values if a parameter
  is deleted. This happens on save when the Code Source itself wasn't edited:
  http://preprod30.infrae.com/++preview++/about
  If you scroll down, next to the "Open Source Experience" heading there's an
  empty Code Source, which used to contain values as like here:
  http://infrae.com/about
  I deleted the alignment parameter, since it's now built-in, and when I tested
  I noticed that it lost all parameter values. Can this be fixed so existing
  values are preserved?

CS Silva Portlet
----------------
+ New detail: the source only errors in preview. In the public view it renders
  fine, regardless of where the embedded doc is. Still needs to be fixed, but
  this makes it less urgent.
  If the document you're embedding is in the root, the souce throws an error.
  Example doc: http://preprod30.infrae.com/edit#content!lobby/testors/portleteur
  Embedded doc: http://preprod30.infrae.com/edit#content!lobby/locateabove
  Code Source: http://preprod30.infrae.com/cs_portlet_element/editCodeSource


CKEditor
========

+ s/r "Link to an another content" "Link to a content item"

++ When inserting an image that is scaled to 20%, CKEditor inserts the full size
  hires version. See the Silva icon:
  http://preprod30.infrae.com/edit#content!lobby/testors/imaging

- When linking an image to its hires version, you click the "Link to the hires
  version of the image" checkbox. However if you return to check this, the
  checkbox is no longer checked. Instead, the other checkox, "Link to an another
  content" is checked. This is technically correct, but weird UX. You think
  something went wrong and it somehow got linked to something else. We'll need
  to figure out a better way.

++ Linking to hires doesn't work. It links to the image sans argument.

- Adding a link to an image fails. It just doesn't stick.

  Now I've finally figured out that you can't add a link to an image. You can
  only add a link to text. But if you edit the image, then when you're editing
  it, you can add a link. Is this CKEditor behavior? Because I fear our users
  will never unlearn this process. Or is it a bug?

  Can we code it so that if a user selects an image and then clicks the link
  icon, they're brought to the image edit dialog with the link tab forward?

+ Here's a doozy. When you add a link to an image with a caption, the href
  surrounds the whole thing and the caption becomes a link too. This is not
  good. Sometimes captions contain links, but usually only certain words. This
  which is why we make our captions manually in the docs. We need to wrap the
  href around only the image. In the html the caption is inside the link:

  <div class="image default">
	  <a class="image-link" target="_self" href=""><img alt="Infrae telephone QR code" src="http://preprod30.infrae.com/++preview++/contact/infrae_qr_tel.png"><span class="image-caption">Infrae telephone QR code</span></a></div>

  This is not a problem for getting infrae.com live, we just won't use captions.
  But the link should not enclose both.

++ When you add an image in CKEditor, you usually add the image on an empty
  line. When done adding, it looks fine. After saving, the editor inserts an
  extra p with a nbsp above the image. You always have to remove this p after
  saving.

+ In the add image dialog "Use image alternative text as caption" is checked by
  default.This means users always add images with a caption but don't realize it
  (e.g. Wim did it in the UCL documentation). This is a handy feature, but
  please make it unchecked by default. That way it's more obvious that you can
  add a caption (assuming stylesheets have been updated for 3.0 to support it)
  and people won't mistakenly add a caption and have to re-edit.

  When making unchecked the default, it's probably friendlier to move the
  checkbox above the "Image caption" field. That way when an Author decides to
  use the alternative text, the string field will disappear.

++ version document/get_viewable
  details version/@@details
  details/get_text
  details/get_introduction
  details/get_thumbnail
  details version/@@details....

  These don't work for Ghosts. The @@details fails:
  http://preprod30.infrae.com/++preview++/service

  > We can even add a get_title.
  + Yes, please.

++ External images get broken after saving. If you add external images, they get removed one by one after a save. Looking at the source it looks like a stripping action occurs on "<img data-silva-src="http://www.packtpub.com/sites/default/files/Article-Images/silva-468x60.gif" />" whyich becomes "<img data-silva-="" src="http://www.packtpub.com/sites/default/files/Article-Images/silva-468x60.gif" />" after a save. After a second save the img element becomes empty.

Lists
-----

+ creating sub level lists using the tab doesn't work (FF and IE8). In IE8 the SMI green loading lights keep spinning when trying to indent a level so probably this is some JS issue.

Note: moved list types and css selectors from here to documentation.txt.
We aren't going to migrate the list styles. Most of our customers probably don't
use them. However, if the styles - like class="square" - are needed they can be
added to the formats. An Author will then need to first create an unordered list
using the button in the toolbar, then apply a style to it using the format
dropdown.

Reference dialog
================

- Reference dialog title: s/"Lookup a content" / "Lookup an item"

- The reference dialog has a difficult user interface if there are more
  than a few items in the listing. The selection(s) show up at the bottom
  of the listing, often out of sight for the user. Can we put the selected
  list on top?
  """WB: Which reference dialog is this? The ones I use only use one reference
  selection, which is never displayed"""

- In the reference dialog clicking the icon of a non-container doesn't do
  anything. Make it trigger the same action as the 'plus' icon on the right.
  This obviates the need to move the mouse across the screen, which new
  users find confusing because the selection checkbox used to be on the left.
  """WB: Non of the icons reference the add action, only the '+' icon adds a
  reference."""

Bugs
====
- How can a user export one document? We only have an export screen in
  containers now. Can we add an Export option to the "Edit" tab, like the
  Details option in news items?

----> How did you do this in the past ?

----+ In the Status screen, click the Export button, e.g.:
      http://infrae.com/lobby/testors/imagealigns/edit/tab_status
      But there's some hack that somehow brings you up into the folder with an
      argument to export only that particular document. This is an extremely
      handy feature.

Folder/container order
----------------------

If you change the order of a container, the order will be reset to its previous order after a restart of the server.

To Test
-------
- CSV upload has problems.
  Invalid CSV file: new-line character seen in unquoted field - do you need to open the file in universal-newline mode?

Silva news
----------

Tested:
- Inside new News Pubs the addables are not set correctly.
  After a fresh upgrade the News Item is not selected in Addables (but
  strangely enough Agenda Item is).

Metadata system
---------------

XXX Still 404s:
http://preprod30.infrae.com/service_metadata/collection/augmentation/manage_settings
+ It's not possible to make a metadata set editable. It 404s.

XXX Still 404s:
http://preprod30.infrae.com/service_metadata/collection/augmentation/?%3Amethod=addElementForm&submit=+Add+Metadata+Element
+ It's not possible to add a field to a metadata set. It 404s.

+ (You cannot remove the title from the document editor. Should this be possible
  ?)
  [Let's keep it this way. The only way to remove the title is in properties.]

  > I can change this, that is trivial. If yes, move point to
    testing.txt. If no delete it.

Migration
=========
++ These docs and many others are not editable:
  http://preprod30.infrae.com/edit#content!service/support
  http://preprod30.infrae.com/edit#content!products/mobi
  There seems to be a glitch sometimes where the content in the editor doesn't load. Either you make a new version or change screens and the green loading lights continue to pulse, but the content never shows up.
  - You can view source (once) and see html, but the WYSIWYG never displays.
  - If I delete things like a broken external source, the text appears but I get a server error on saving the document.


Here are weekend testing results. There's good news and bad news of course.

Editor content display problem

The bad news is there's a glitch where sometimes the content in the editor doesn't display. Happens with FF and WebKit browsers. The green loading lights continue to pulse, but the content never shows up. However the source is there. These docs and many others are not editable:
  http://preprod30.infrae.com/edit#content!service/support
  http://preprod30.infrae.com/edit#content!products/mobi

You can view source once and see html, but the WYSIWYG never displays. Strangely, you can only view source once.

If I delete things like a broken external source, the text appears in WYSIWYG but I get a server error on saving the document.


Code source updating

No problems here, just wanted to say that the new forms that link to the file system are great. They work really well, allowing the manager to decide what to do. This also solves the problem of copying and changing, as you can disconnect as well. That was brilliant.


Alignments

I've done some work and specced some simple changes. But let me provide context. The image and external source rendering has changed and the previous alignment classes don't work anymore. If we can't fix this, it means Silva users will have to duplicate a bunch of selectors as part of the upgrade.

Here the keyword is duplicate, because they need to keep the old ones, for those docs that haven't been edited yet, and add new ones for the new classes that appear after a doc gets edited.

Just to make this clear, here are the old alignment selectors, as used in all the Infrae sites:

  /* alignments */
  .align-left {  }
  .align-right { float:right; clear:both; }
  .float-left { float:left; clear:both; }
  .float-right { float:right; clear:both; } /* display:none in mobile skin */
  div.align-center { text-align:center; margin:0; }
  /* image alignments */
  div.image-left { float:left; margin:5px 6px 5px 0; } /* icons midline */
  div.image-center { text-align:center; margin:0; }
  div.image-right { float:right; margin:8px 0 10px 20px; }
  img.default { margin-bottom:0.7em; }
  div.image.float-left { margin:6px 10px 5px 0; } /* nested cap height */
  div.image.float-right { margin:6px 0 5px 10px; }  /* nested x height */

I've added the following to the Renaissance skin:

  /* duplicated selectors for 3.0 alignment classes */
  div.source-left { float:left; clear:both; }
  div.source-center { text-align:center; margin:0; }
  div.source-right { float:right; clear:both; }
  div.source-float-left { float:left; clear:both; }
  div.source-float-right { float:right; clear:both; } /* XXX must display:none in mobile skin */
  /* duplicated image alignments */
  div.image.default { margin-bottom:0.7em; }
  div.image-float-left { float:left; clear:both; margin:6px 10px 5px 0; } /* nested cap height */
  div.image-float-right { float:right; clear:both; margin:6px 0 5px 10px; }  /* nested x height */

We can get rid of almost all of these by doing the following:

For external sources (which have the alignment field by default), change the option values in the select list to:

  default
  align-left
  align-center
  align-right
  float-left
  float-right

This will get rid of all the duplicated 'source-*' selectors.

For images, we just need to remove the 'image-' on the floats. So:

  image-float-left
  image-float-right

become:

  float-left
  float-right

Then we'll have only one new selector and all pages will display the same as before the upgrade.

It's still annoying that we're wrapping extra divs around images when they're not needed, but we can say that's not us, that's the editor. So there's still one selector that we will need to add for the default image. But just one,

Can you make these changes to the css classes? If for any reason it's problematic, let me know.
